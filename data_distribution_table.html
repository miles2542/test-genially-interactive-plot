<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uber Data Atlas | Executive View</title>

    <!-- FONTS: Inter (Standard for modern UI) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- DATA SOURCE -->
    <script src="data_payload.js"></script>
    <!-- If not using external file, remove line above and paste content inside <script> below -->

    <style>
        /* =========================================
           1. UBER DESIGN SYSTEM (TOKENS)
           ========================================= */
        :root {
            /* Palette */
            --uber-black: #000000;
            --uber-white: #FFFFFF;
            --uber-green: #276EF1;
            /* Uber Blue for UI, Green for Data */
            --data-green: #47B275;
            --data-green-light: rgba(71, 178, 117, 0.15);
            --data-red: #F25138;
            --data-red-light: rgba(242, 81, 56, 0.15);
            --data-orange: #FF7D49;

            /* Grays */
            --gray-100: #F6F6F6;
            --gray-200: #EEEEEE;
            --gray-300: #E2E2E2;
            --gray-600: #545454;

            /* Dimensions */
            --sidebar-width: 260px;
            --header-height: 40px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            background: var(--gray-100);
            height: 100vh;
            display: flex;
            overflow: hidden;
            /* Prevent body scroll, use inner containers */
        }

        /* =========================================
           2. SIDEBAR (CONTROLS)
           ========================================= */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--uber-white);
            border-right: 1px solid var(--gray-300);
            display: flex;
            flex-direction: column;
            padding: 24px;
            z-index: 20;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.02);
        }

        .brand {
            font-size: 18px;
            font-weight: 600;
            letter-spacing: -0.5px;
            color: var(--uber-black);
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* DROPDOWN STYLING */
        .control-group {
            margin-bottom: 40px;
        }

        .label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-weight: 600;
            color: var(--gray-600);
            margin-bottom: 8px;
            display: block;
        }

        select {
            width: 100%;
            padding: 10px 12px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            background: var(--uber-white);
            color: var(--uber-black);
            cursor: pointer;
            outline: none;
            transition: border-color 0.2s;
        }

        select:hover {
            border-color: var(--gray-600);
        }

        select:focus {
            border-color: var(--uber-black);
        }

        /* VERTICAL SLIDER CONTAINER */
        .scrubber-container {
            flex-grow: 1;
            display: flex;
            flex-direction: row;
            gap: 20px;
            align-items: center;
            justify-content: center;
            position: relative;
            background: var(--gray-100);
            border-radius: 8px;
            padding: 20px 0;
        }

        /* The Custom Vertical Slider */
        input[type=range][orient=vertical] {
            writing-mode: bt-lr;
            /* IE/Edge */
            -webkit-appearance: slider-vertical;
            /* Chrome/Safari */
            width: 8px;
            height: 200px;
            padding: 0 5px;
            cursor: ns-resize;
        }

        /* Fallback / Custom styling for slider track if needed can go here, 
           but native vertical slider is usually smoothest for this specific interaction */

        .scrubber-labels {
            height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 11px;
            font-weight: 600;
            text-align: left;
            padding-right: 10px;
        }

        .state-label {
            transition: color 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .state-raw {
            color: var(--gray-300);
        }

        .state-proc {
            color: var(--gray-300);
        }

        /* Dynamic Active States */
        .mode-raw .state-raw {
            color: var(--data-red);
        }

        .mode-proc .state-proc {
            color: var(--data-green);
        }

        /* Footer */
        .footer {
            margin-top: auto;
            font-size: 10px;
            color: var(--gray-600);
            line-height: 1.4;
            border-top: 1px solid var(--gray-200);
            padding-top: 16px;
        }

        /* =========================================
           3. MAIN VIEW (DATA TABLE)
           ========================================= */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background: var(--uber-white);
            position: relative;
        }

        /* HEADER INFO */
        .info-bar {
            padding: 20px 32px;
            border-bottom: 1px solid var(--gray-300);
            background: var(--uber-white);
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .metric-title {
            font-size: 24px;
            font-weight: 500;
            color: var(--uber-black);
            margin: 0;
        }

        .metric-subtitle {
            font-size: 13px;
            color: var(--gray-600);
            margin-top: 4px;
        }

        .status-badge {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Status Badge Colors */
        .mode-raw .status-badge {
            background: var(--data-red-light);
            color: var(--data-red);
        }

        .mode-proc .status-badge {
            background: var(--data-green-light);
            color: var(--data-green);
        }


        /* TABLE SCROLL AREA */
        .table-wrapper {
            flex-grow: 1;
            overflow: auto;
            /* Both X and Y scroll */
            position: relative;
        }

        table {
            border-collapse: separate;
            /* Required for sticky to work well with borders */
            border-spacing: 0;
            width: 100%;
            font-size: 13px;
        }

        /* TABLE HEADERS */
        th {
            position: sticky;
            top: 0;
            z-index: 10;
            background: var(--gray-100);
            color: var(--gray-600);
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 10px 12px;
            text-align: right;
            border-bottom: 1px solid var(--gray-300);
            border-right: 1px solid transparent;
            /* Gutter */
        }

        /* Sticky First Column (Date) */
        th:first-child {
            position: sticky;
            left: 0;
            z-index: 20;
            text-align: left;
            background: var(--gray-100);
            border-right: 2px solid var(--uber-black);
            min-width: 90px;
        }

        /* TABLE CELLS */
        td {
            padding: 6px 12px;
            text-align: right;
            white-space: nowrap;
            border-bottom: 1px solid var(--gray-100);
            color: var(--uber-black);
            font-variant-numeric: tabular-nums;
            /* Monospaced numbers */
        }

        /* Sticky First Column (Date) */
        td:first-child {
            position: sticky;
            left: 0;
            z-index: 5;
            text-align: left;
            background: var(--uber-white);
            font-weight: 500;
            font-size: 12px;
            border-right: 2px solid var(--uber-black);
        }

        tr:hover td {
            background-color: #FAFAFA;
        }

        tr:hover td:first-child {
            background-color: #FAFAFA;
        }

        /* =========================================
           4. VISUALIZATION HELPERS (Dynamic)
           ========================================= */

        /* Transition effect for cells when scrubbing */
        td {
            transition: background-color 0.2s, color 0.2s;
        }

        /* Highlight classes */
        .val-mean {
            font-weight: 600;
            color: var(--uber-black);
            border-left: 1px solid var(--gray-300);
        }

        .val-max {
            font-weight: 600;
            color: var(--uber-black);
            border-left: 1px solid var(--gray-300);
        }
    </style>
</head>

<body class="mode-raw"> <!-- Default State -->

    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="brand">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="2" width="9" height="9" fill="black" />
                <rect x="13" y="2" width="9" height="9" fill="black" />
                <rect x="2" y="13" width="9" height="9" fill="black" />
                <rect x="13" y="13" width="9" height="9" fill="#47B275" /> <!-- Green accent for prep -->
            </svg>
            Data Atlas
        </div>

        <div class="control-group">
            <label class="label">Select Feature</label>
            <select id="featureSelect">
                <!-- Javascript will populate this -->
            </select>
        </div>

        <div class="label" style="text-align: center; margin-bottom: 10px;">Scrub Data State</div>

        <div class="scrubber-container">
            <div class="scrubber-labels">
                <span class="state-label state-raw">Raw<br>Input</span>
                <span class="state-label state-proc">Refined<br>Output</span>
            </div>
            <!-- Vertical Slider: 0 = Raw (Top), 1 = Processed (Bottom) -->
            <!-- Note: standard range input is Min(Left/Bottom) to Max(Right/Top) -->
            <!-- We will handle logic in JS: 0=Proc, 1=Raw, or visual inversion -->
            <input type="range" id="stateSlider" min="0" max="1" step="1" value="0" orient="vertical">
        </div>

        <div class="footer">
            NYC TLC Trip Records<br>
            2019 - 2025<br>
            <span style="opacity: 0.5">Confidential â€¢ Internal Use</span>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <div class="info-bar">
            <div>
                <h1 class="metric-title" id="displayTitle">Loading...</h1>
                <div class="metric-subtitle">Monthly Statistical Distribution</div>
            </div>
            <div id="statusBadge" class="status-badge">RAW DATA</div>
        </div>

        <div class="table-wrapper">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>Audit Month</th>
                        <th>Total Rows</th>
                        <!-- Distribution Group -->
                        <th>MIN</th>
                        <th>P01</th>
                        <th>P50</th>
                        <!-- Avg -->
                        <th class="val-mean" style="min-width: 80px">MEAN</th>
                        <!-- Risk Group -->
                        <th style="border-left: 1px solid var(--gray-300)">STD</th>
                        <th>P99</th>
                        <th>P99.9</th>
                        <!-- Max -->
                        <th class="val-max" style="min-width: 80px">MAX</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Javascript populates this -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. INITIALIZATION & SETUP
        // ==========================================

        // Ensure data is loaded
        if (typeof ATLAS_DATA === 'undefined') {
            alert("Error: data_payload.js not found. Please ensure the file is in the same directory.");
        }

        const featureSelect = document.getElementById('featureSelect');
        const stateSlider = document.getElementById('stateSlider');
        const tableBody = document.getElementById('tableBody');
        const displayTitle = document.getElementById('displayTitle');
        const statusBadge = document.getElementById('statusBadge');
        const bodyTag = document.body;

        // Populate Dropdown
        const features = Object.keys(ATLAS_DATA.features).sort();
        features.forEach(feat => {
            const opt = document.createElement('option');
            opt.value = feat;
            opt.text = feat.replace(/_/g, " ").toUpperCase();
            featureSelect.appendChild(opt);
        });

        // ==========================================
        // 2. HELPER FUNCTIONS (VISUALIZATION)
        // ==========================================

        // Format Numbers: 1,234.56
        const fmt = new Intl.NumberFormat('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });

        // Format Integers: 1,234
        const fmtInt = new Intl.NumberFormat('en-US', {
            maximumFractionDigits: 0
        });

        /**
         * Generates the background style string
         * @param {number} val - The cell value
         * @param {number} maxVal - The GLOBAL MAX for this column (scaling factor)
         * @param {string} type - 'blue-grad', 'red-grad', 'bar'
         * @param {boolean} isProcessed - true if clean data (Green), false if raw (Red/Orange)
         */
        function getStyle(val, maxVal, type, isProcessed) {
            if (val === null || val === undefined) return '';

            const absVal = Math.abs(val);
            const ratio = Math.min(absVal / maxVal, 1);
            const pct = ratio * 100;

            // COLOR PALETTE LOGIC
            // Raw (False) = Red/Orange/Blue mix (Chaotic)
            // Processed (True) = Green/Clean

            let colorBase;

            if (isProcessed) {
                // CLEAN MODE: Greens
                if (type === 'risk') colorBase = `rgba(71, 178, 117, ${ratio * 0.5})`; // Green tint
                if (type === 'safe') colorBase = `rgba(39, 110, 241, ${ratio * 0.4})`; // Uber Blue tint
                if (type === 'bar') return `background: linear-gradient(90deg, #47B275 ${pct}%, transparent ${pct}%)`;
            } else {
                // RAW MODE: Reds/Oranges
                if (type === 'risk') colorBase = `rgba(242, 81, 56, ${ratio * 0.6})`; // Red tint
                if (type === 'safe') colorBase = `rgba(93, 165, 218, ${ratio * 0.4})`; // Blue tint
                if (type === 'bar') return `background: linear-gradient(90deg, #F25138 ${pct}%, transparent ${pct}%)`;
            }

            // Return gradient style for cells
            return `background-color: ${colorBase}`;
        }

        // ==========================================
        // 3. RENDER LOGIC
        // ==========================================

        function render() {
            const featName = featureSelect.value;
            // Slider Logic: Range is 0 to 1. 
            // 0 = RAW (Top visually, depends on CSS orient). 
            // In standard slider vertical: Bottom is Min, Top is Max.
            // Let's assume input value 1 = Top (Raw), 0 = Bottom (Processed).
            // Actually, usually vertical sliders have min at bottom. 
            // Let's check value. We want Drag DOWN to Clean.
            // So Top (Max value) = Raw. Bottom (Min value) = Processed.

            // Slider Value: 0 (Proc) -> 1 (Raw)
            // wait, HTML says min=0 max=1.
            // Let's treat value "1" as RAW (Top) and "0" as PROCESSED (Bottom)
            // So dragging slider down reduces value to 0.

            const sliderVal = parseInt(stateSlider.value);
            const isRaw = (sliderVal === 1);
            const isProcessed = !isRaw;

            const dataSetKey = isRaw ? 'raw' : 'processed';
            const featData = ATLAS_DATA.features[featName];
            const currentData = featData[dataSetKey];
            const stats = featData.stats; // Global Maxes

            // Update UI State
            if (isRaw) {
                bodyTag.classList.remove('mode-proc');
                bodyTag.classList.add('mode-raw');
                statusBadge.innerText = "RAW INPUT (DIRTY)";
                displayTitle.innerText = featName.replace(/_/g, " ").toUpperCase(); // + " (RAW)";
            } else {
                bodyTag.classList.remove('mode-raw');
                bodyTag.classList.add('mode-proc');
                statusBadge.innerText = "REFINED OUTPUT (CLEAN)";
                displayTitle.innerText = featName.replace(/_/g, " ").toUpperCase(); // + " (CLEAN)";
            }

            // Clear Table
            tableBody.innerHTML = '';

            // Generate Rows
            ATLAS_DATA.dates.forEach((date, i) => {
                const tr = document.createElement('tr');

                // Helper to get value safely
                const getVal = (suffix) => currentData[suffix] ? currentData[suffix][i] : 0;

                // Values
                const v_min = getVal('min');
                const v_p01 = getVal('p01');
                const v_p50 = getVal('p50');
                const v_mean = getVal('mean');
                const v_std = getVal('std');
                const v_p99 = getVal('p99');
                const v_p999 = getVal('p99.9');
                const v_max = getVal('max');
                const v_rows = currentData['rows'] ? currentData['rows'][i] : 0;

                tr.innerHTML = `
                    <td>${date}</td>
                    <td style="color: var(--gray-600)">${fmtInt.format(v_rows)}</td>
                    
                    <td style="${getStyle(v_min, stats.min_max, 'safe', isProcessed)}">${fmt.format(v_min)}</td>
                    <td style="${getStyle(v_p01, stats.p01_max, 'safe', isProcessed)}">${fmt.format(v_p01)}</td>
                    <td style="${getStyle(v_p50, stats.p50_max, 'safe', isProcessed)}">${fmt.format(v_p50)}</td>
                    
                    <td class="val-mean" style="${getStyle(v_mean, stats.mean_max, 'bar', isProcessed)}">${fmt.format(v_mean)}</td>
                    
                    <td style="border-left: 1px solid var(--gray-300); ${getStyle(v_std, stats.std_max, 'risk', isProcessed)}">${fmt.format(v_std)}</td>
                    <td style="${getStyle(v_p99, stats.p99_max, 'risk', isProcessed)}">${fmt.format(v_p99)}</td>
                    <td style="${getStyle(v_p999, stats.p999_max, 'risk', isProcessed)}">${fmt.format(v_p999)}</td>
                    
                    <td class="val-max" style="${getStyle(v_max, stats.max_max, 'bar', isProcessed)}">${fmtInt.format(v_max)}</td>
                `;

                tableBody.appendChild(tr);
            });
        }

        // ==========================================
        // 4. EVENT LISTENERS
        // ==========================================

        featureSelect.addEventListener('change', render);

        stateSlider.addEventListener('input', render);

        // Initial set: Set slider to Top (1 = Raw) by default? Or Processed?
        // Let's start with RAW (1) so they can scrub down to Clean (0)
        stateSlider.value = 1;

        // Init
        render();

    </script>
</body>

</html>
